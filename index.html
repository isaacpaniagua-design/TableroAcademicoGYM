<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EduControl Pro - Sistema Real con Google Sheets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .card-shadow {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }
      .notification-enter {
        animation: slideInRight 0.3s ease-out;
      }
      @keyframes slideInRight {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .pulse-green {
        animation: pulse-green 2s infinite;
      }
      @keyframes pulse-green {
        0%,
        100% {
          background-color: #10b981;
        }
        50% {
          background-color: #059669;
        }
      }
      .spin-blue {
        animation: spin 1s linear infinite;
        background-color: #3b82f6;
      }
      .pulse-yellow {
        animation: pulse-yellow 1s infinite;
      }
      @keyframes pulse-yellow {
        0%,
        100% {
          background-color: #f59e0b;
        }
        50% {
          background-color: #d97706;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Contenedor de Notificaciones -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Indicador de Carga -->
    <div
      id="loadingIndicator"
      class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50"
    >
      <i class="fas fa-spinner fa-spin mr-2"></i>Sincronizando con Google
      Sheets...
    </div>

    <!-- Pantalla de Login -->
    <div
      id="loginScreen"
      class="min-h-screen gradient-bg flex items-center justify-center p-4"
    >
      <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md fade-in">
        <div class="text-center mb-8">
          <div
            class="w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <i class="fas fa-graduation-cap text-white text-2xl"></i>
          </div>
          <h1 class="text-3xl font-bold text-gray-800">EduControl Pro</h1>
          <p class="text-gray-600 mt-2">Sistema Real con Google Sheets</p>
          <div class="flex items-center justify-center mt-3 space-x-2">
            <div
              id="loginConnectionStatus"
              class="w-3 h-3 bg-gray-400 rounded-full"
            ></div>
            <span class="text-xs text-gray-500">Google Sheets</span>
          </div>
        </div>

        <form id="loginForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Carrera</label
            >
            <select
              id="career"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              required
            >
              <option value="">Seleccionar carrera</option>
              <option value="software">Ingenier√≠a en Software</option>
              <option value="mecatronica">
                Ingenier√≠a en Mecatr√≥nica y Manufactura
              </option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Email</label
            >
            <input
              type="email"
              id="email"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              placeholder="Ingresa tu email"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Contrase√±a</label
            >
            <input
              type="password"
              id="password"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              placeholder="Ingresa tu contrase√±a"
              required
            />
          </div>

          <button
            type="submit"
            class="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition duration-200 font-medium"
          >
            Iniciar Sesi√≥n
          </button>
        </form>

        <div class="mt-6 text-center space-y-2">
          <button
            id="setupGoogleSheetsBtn"
            class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200 text-sm"
          >
            <i class="fas fa-cog mr-2"></i>Configurar Google Sheets
          </button>
          <button
            id="resetPasswordBtn"
            class="text-indigo-600 hover:text-indigo-800 text-sm"
          >
            ¬øOlvidaste tu contrase√±a?
          </button>
        </div>

        <!-- Configuraci√≥n r√°pida de Google Sheets -->
        <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <h4
            class="text-sm font-semibold text-blue-800 mb-3 flex items-center"
          >
            <i class="fas fa-rocket mr-2"></i>Configuraci√≥n R√°pida
          </h4>
          <div class="space-y-3">
            <div>
              <label class="block text-xs font-medium text-blue-700 mb-1"
                >URL de tu Google Apps Script:</label
              >
              <input
                type="url"
                id="quickSetupUrl"
                class="w-full px-3 py-2 text-sm border border-blue-300 rounded-lg"
                placeholder="https://script.google.com/macros/s/.../exec"
              />
            </div>
            <button
              onclick="quickSetupGoogleSheets()"
              class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200 text-sm"
            >
              <i class="fas fa-link mr-2"></i>Conectar Ahora
            </button>
          </div>
          <p class="text-xs text-blue-600 mt-2">
            üí° Si no tienes la URL, haz clic en "Configurar Google Sheets" abajo
          </p>
        </div>

        <!-- Usuarios de prueba -->
        <div class="mt-4 p-4 bg-gray-50 rounded-lg">
          <p class="text-xs text-gray-600 mb-2">
            Usuarios de prueba (se crean autom√°ticamente):
          </p>
          <div class="text-xs space-y-1">
            <p><strong>Admin:</strong> admin@edu.com / admin123</p>
            <p><strong>Profesor:</strong> profesor@edu.com / prof123</p>
            <p><strong>Docente:</strong> docente@edu.com / doc123</p>
          </div>
          <p class="text-xs text-green-600 mt-2">
            ‚úÖ Datos reales en Google Sheets
          </p>
        </div>
      </div>
    </div>

    <!-- Dashboard Principal -->
    <div id="dashboard" class="hidden min-h-screen bg-gray-50">
      <!-- Header -->
      <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="flex items-center justify-between px-6 py-4">
          <div class="flex items-center space-x-4">
            <div
              id="headerCareerIcon"
              class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center"
            >
              <i class="fas fa-graduation-cap text-white"></i>
            </div>
            <div>
              <h1 class="text-xl font-semibold text-gray-800">
                EduControl Pro
              </h1>
              <p id="headerCareerName" class="text-sm text-gray-600">
                Sistema Real
              </p>
            </div>
          </div>

          <div class="flex items-center space-x-4">
            <!-- Selector de Carrera (Solo Admin) -->
            <div id="careerSelector" class="hidden">
              <select
                id="switchCareer"
                class="px-3 py-2 border border-gray-300 rounded-lg text-sm"
              >
                <option value="software">Ing. Software</option>
                <option value="mecatronica">Ing. Mecatr√≥nica</option>
              </select>
            </div>

            <!-- Controles de Sincronizaci√≥n -->
            <div class="flex items-center space-x-2">
              <button
                id="forceSyncBtn"
                class="p-2 text-gray-600 hover:text-gray-800 transition-colors"
                title="Sincronizar ahora"
              >
                <i class="fas fa-sync-alt"></i>
              </button>
              <div class="relative">
                <button
                  id="syncSettingsBtn"
                  class="p-2 text-gray-600 hover:text-gray-800 transition-colors"
                  title="Configuraci√≥n de sincronizaci√≥n"
                >
                  <i class="fas fa-cog"></i>
                </button>
                <div
                  id="syncSettingsDropdown"
                  class="hidden absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border z-50"
                >
                  <div class="p-4">
                    <h3 class="font-semibold text-gray-800 mb-3">
                      Configuraci√≥n de Sincronizaci√≥n
                    </h3>

                    <div class="space-y-3">
                      <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">Estado:</span>
                        <button
                          id="toggleSyncBtn"
                          class="px-3 py-1 text-xs bg-green-100 text-green-800 rounded-full"
                        >
                          Activa
                        </button>
                      </div>

                      <div>
                        <label class="block text-sm text-gray-600 mb-1"
                          >Frecuencia:</label
                        >
                        <select
                          id="syncFrequencySelect"
                          class="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                        >
                          <option value="15">Cada 15 segundos</option>
                          <option value="30" selected>Cada 30 segundos</option>
                          <option value="60">Cada 1 minuto</option>
                          <option value="300">Cada 5 minutos</option>
                          <option value="600">Cada 10 minutos</option>
                        </select>
                      </div>

                      <div
                        id="syncStats"
                        class="text-xs text-gray-500 bg-gray-50 p-2 rounded"
                      >
                        <!-- Estad√≠sticas de sincronizaci√≥n -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Estado de Conexi√≥n -->
            <div id="connectionStatus" class="flex items-center space-x-2">
              <div
                id="connectionIndicator"
                class="w-3 h-3 bg-gray-400 rounded-full"
              ></div>
              <span class="text-xs text-gray-600">Google Sheets</span>
            </div>

            <!-- Perfil -->
            <div class="flex items-center space-x-3">
              <img
                id="headerProfileImg"
                src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23e5e7eb'/%3E%3Cpath d='M20 20c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6zm0 2c-4 0-12 2-12 6v2h24v-2c0-4-8-6-12-6z' fill='%236b7280'/%3E%3C/svg%3E"
                alt="Perfil"
                class="w-10 h-10 rounded-full"
              />
              <div>
                <p
                  id="headerUserName"
                  class="text-sm font-medium text-gray-800"
                >
                  Usuario
                </p>
                <p id="headerUserRole" class="text-xs text-gray-600">Rol</p>
              </div>
            </div>

            <button id="logoutBtn" class="text-gray-600 hover:text-gray-800">
              <i class="fas fa-sign-out-alt text-xl"></i>
            </button>
          </div>
        </div>
      </header>

      <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-sm min-h-screen">
          <nav class="p-6">
            <ul id="sidebarMenu" class="space-y-2">
              <!-- El men√∫ se genera din√°micamente seg√∫n el rol -->
            </ul>
          </nav>
        </aside>

        <!-- Contenido Principal -->
        <main class="flex-1 p-6">
          <!-- Dashboard Overview -->
          <div id="overviewSection" class="fade-in">
            <div class="mb-6">
              <h2 class="text-2xl font-bold text-gray-800">Panel de Control</h2>
              <p class="text-gray-600">
                Sistema conectado en tiempo real con Google Sheets
              </p>
              <div id="currentCareerBadge" class="mt-2">
                <!-- Badge de carrera actual -->
              </div>
            </div>

            <!-- Estad√≠sticas -->
            <div
              id="statsCards"
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"
            >
              <!-- Las tarjetas se generan din√°micamente -->
            </div>

            <!-- Gr√°ficos y Actividad Reciente -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="bg-white rounded-xl card-shadow p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                  Estado del Sistema
                </h3>
                <div class="space-y-4">
                  <div
                    class="flex items-center justify-between p-3 bg-green-50 rounded-lg"
                  >
                    <div class="flex items-center space-x-3">
                      <i class="fas fa-database text-green-600"></i>
                      <span class="text-sm font-medium text-green-800"
                        >Google Sheets</span
                      >
                    </div>
                    <span class="text-xs text-green-600">Conectado</span>
                  </div>
                  <div
                    class="flex items-center justify-between p-3 bg-blue-50 rounded-lg"
                  >
                    <div class="flex items-center space-x-3">
                      <i class="fas fa-sync-alt text-blue-600"></i>
                      <span class="text-sm font-medium text-blue-800"
                        >Sincronizaci√≥n</span
                      >
                    </div>
                    <span class="text-xs text-blue-600">Tiempo Real</span>
                  </div>
                  <div
                    class="flex items-center justify-between p-3 bg-purple-50 rounded-lg"
                  >
                    <div class="flex items-center space-x-3">
                      <i class="fas fa-shield-alt text-purple-600"></i>
                      <span class="text-sm font-medium text-purple-800"
                        >Seguridad</span
                      >
                    </div>
                    <span class="text-xs text-purple-600">Activa</span>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-xl card-shadow p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                  Actividad Reciente
                </h3>
                <div id="recentActivity" class="space-y-3">
                  <!-- Actividades recientes se generan din√°micamente -->
                </div>
              </div>
            </div>
          </div>

          <!-- Gesti√≥n de Usuarios -->
          <div id="usersSection" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
              <div>
                <h2 class="text-2xl font-bold text-gray-800">
                  Gesti√≥n de Usuarios
                </h2>
                <p class="text-gray-600">Administra usuarios del sistema</p>
              </div>
              <button
                id="addUserBtn"
                class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200"
              >
                <i class="fas fa-plus mr-2"></i>Agregar Usuario
              </button>
            </div>

            <div class="bg-white rounded-xl card-shadow overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        ID
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Usuario
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Email
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Rol
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Estado
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Fecha Registro
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Acciones
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="usersTable"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- Usuarios se generan din√°micamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Gesti√≥n de Actividades -->
          <div id="activitiesSection" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
              <div>
                <h2 class="text-2xl font-bold text-gray-800">
                  Gesti√≥n de Actividades
                </h2>
                <p class="text-gray-600">
                  Administra las actividades acad√©micas
                </p>
              </div>
              <button
                id="addActivityBtn"
                class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200"
              >
                <i class="fas fa-plus mr-2"></i>Nueva Actividad
              </button>
            </div>

            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              id="activitiesGrid"
            >
              <!-- Actividades se generan din√°micamente -->
            </div>
          </div>

          <!-- Gesti√≥n de Docentes -->
          <div id="teachersSection" class="hidden fade-in">
            <div class="flex justify-between items-center mb-6">
              <div>
                <h2 class="text-2xl font-bold text-gray-800">
                  Gesti√≥n de Docentes
                </h2>
                <p class="text-gray-600">Administra el personal docente</p>
              </div>
              <button
                id="addTeacherBtn"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200"
              >
                <i class="fas fa-plus mr-2"></i>Agregar Docente
              </button>
            </div>

            <div class="bg-white rounded-xl card-shadow overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        ID
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Nombre
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Email
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Especialidad
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Tel√©fono
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Estado
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        Acciones
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="teachersTable"
                    class="bg-white divide-y divide-gray-200"
                  >
                    <!-- Docentes se generan din√°micamente -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Reportes -->
          <div id="reportsSection" class="hidden fade-in">
            <div class="mb-6">
              <h2 class="text-2xl font-bold text-gray-800">
                Reportes y An√°lisis
              </h2>
              <p class="text-gray-600">
                Genera reportes detallados del progreso acad√©mico
              </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              <div class="bg-white rounded-xl card-shadow p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                  Reportes Individuales
                </h3>
                <div class="space-y-4">
                  <select
                    id="userSelect"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                  >
                    <option value="">Seleccionar usuario</option>
                  </select>
                  <button
                    id="generateIndividualReport"
                    class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200"
                  >
                    <i class="fas fa-file-pdf mr-2"></i>Generar Reporte
                    Individual
                  </button>
                </div>
              </div>

              <div class="bg-white rounded-xl card-shadow p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">
                  Reporte General
                </h3>
                <div class="space-y-4">
                  <div class="flex space-x-2">
                    <input
                      type="date"
                      id="startDate"
                      class="flex-1 px-4 py-2 border border-gray-300 rounded-lg"
                    />
                    <input
                      type="date"
                      id="endDate"
                      class="flex-1 px-4 py-2 border border-gray-300 rounded-lg"
                    />
                  </div>
                  <button
                    id="generateGeneralReport"
                    class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition duration-200"
                  >
                    <i class="fas fa-file-pdf mr-2"></i>Generar Reporte General
                  </button>
                </div>
              </div>
            </div>

            <!-- Progreso Hist√≥rico -->
            <div class="bg-white rounded-xl card-shadow p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-4">
                Progreso Hist√≥rico
              </h3>
              <div id="progressHistory" class="overflow-x-auto">
                <table class="w-full">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Fecha
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Per√≠odo
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Total Actividades
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Completadas
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Total Docentes
                      </th>
                      <th
                        class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"
                      >
                        Generado por
                      </th>
                    </tr>
                  </thead>
                  <tbody id="progressHistoryTable">
                    <!-- Datos de progreso hist√≥rico -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Perfil -->
          <div id="profileSection" class="hidden fade-in">
            <div class="mb-6">
              <h2 class="text-2xl font-bold text-gray-800">Mi Perfil</h2>
              <p class="text-gray-600">Gestiona tu informaci√≥n personal</p>
            </div>

            <div class="bg-white rounded-xl card-shadow p-6">
              <div class="flex items-center space-x-6 mb-6">
                <div class="relative">
                  <img
                    id="profileImg"
                    src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23e5e7eb'/%3E%3Cpath d='M50 50c8.25 0 15-6.75 15-15s-6.75-15-15-15-15 6.75-15 15 6.75 15 15 15zm0 5c-10 0-30 5-30 15v5h60v-5c0-10-20-15-30-15z' fill='%236b7280'/%3E%3C/svg%3E"
                    alt="Foto de perfil"
                    class="w-24 h-24 rounded-full"
                  />
                  <button
                    id="changePhotoBtn"
                    class="absolute bottom-0 right-0 bg-indigo-600 text-white p-2 rounded-full hover:bg-indigo-700 transition duration-200"
                  >
                    <i class="fas fa-camera text-sm"></i>
                  </button>
                </div>
                <div>
                  <h3
                    id="profileName"
                    class="text-xl font-semibold text-gray-800"
                  >
                    Nombre Usuario
                  </h3>
                  <p id="profileRole" class="text-gray-600">Rol del Usuario</p>
                  <p id="profileEmail" class="text-gray-500">
                    email@ejemplo.com
                  </p>
                  <div id="profileCareerBadge" class="mt-2">
                    <!-- Badge de carrera -->
                  </div>
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Nombre Completo</label
                  >
                  <input
                    type="text"
                    id="fullName"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Email</label
                  >
                  <input
                    type="email"
                    id="emailProfile"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Tel√©fono</label
                  >
                  <input
                    type="tel"
                    id="phone"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                  />
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2"
                    >Especialidad</label
                  >
                  <input
                    type="text"
                    id="specialty"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                  />
                </div>
              </div>

              <div class="mt-6 flex space-x-4">
                <button
                  id="saveProfileBtn"
                  class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition duration-200"
                >
                  <i class="fas fa-save mr-2"></i>Guardar Cambios
                </button>
                <button
                  id="changePasswordBtn"
                  class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition duration-200"
                >
                  <i class="fas fa-key mr-2"></i>Cambiar Contrase√±a
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal para Agregar/Editar Usuario -->
    <div
      id="userModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3 id="userModalTitle" class="text-lg font-semibold text-gray-800">
            Agregar Usuario
          </h3>
          <button id="closeUserModal" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="userForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Nombre Completo</label
            >
            <input
              type="text"
              id="modalUserName"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Email</label
            >
            <input
              type="email"
              id="modalUserEmail"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Rol</label
            >
            <select
              id="modalUserRole"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            >
              <option value="">Seleccionar rol</option>
              <option value="administrador">Administrador</option>
              <option value="profesor">Profesor Auxiliar</option>
              <option value="docente">Docente</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Contrase√±a</label
            >
            <input
              type="password"
              id="modalUserPassword"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Tel√©fono</label
            >
            <input
              type="tel"
              id="modalUserPhone"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Especialidad</label
            >
            <input
              type="text"
              id="modalUserSpecialty"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
            />
          </div>

          <div class="flex space-x-3 pt-4">
            <button
              type="submit"
              class="flex-1 bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition duration-200"
            >
              Guardar
            </button>
            <button
              type="button"
              id="cancelUserModal"
              class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition duration-200"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal para Actividades -->
    <div
      id="activityModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl p-6 w-full max-w-lg mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3
            id="activityModalTitle"
            class="text-lg font-semibold text-gray-800"
          >
            Nueva Actividad
          </h3>
          <button
            id="closeActivityModal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="activityForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >T√≠tulo</label
            >
            <input
              type="text"
              id="modalActivityTitle"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Descripci√≥n</label
            >
            <textarea
              id="modalActivityDescription"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg h-24"
              required
            ></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Fecha L√≠mite</label
            >
            <input
              type="date"
              id="modalActivityDeadline"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Prioridad</label
              >
              <select
                id="modalActivityPriority"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                required
              >
                <option value="baja">Baja</option>
                <option value="media">Media</option>
                <option value="alta">Alta</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1"
                >Estado</label
              >
              <select
                id="modalActivityStatus"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                required
              >
                <option value="pendiente">Pendiente</option>
                <option value="en_progreso">En Progreso</option>
                <option value="completada">Completada</option>
              </select>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Asignar a</label
            >
            <select
              id="modalActivityAssignee"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            >
              <option value="">Seleccionar usuario</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Notas</label
            >
            <textarea
              id="modalActivityNotes"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg h-20"
              placeholder="Notas adicionales (opcional)"
            ></textarea>
          </div>

          <div class="flex space-x-3 pt-4">
            <button
              type="submit"
              class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition duration-200"
            >
              Guardar
            </button>
            <button
              type="button"
              id="cancelActivityModal"
              class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition duration-200"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal para Docentes -->
    <div
      id="teacherModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3
            id="teacherModalTitle"
            class="text-lg font-semibold text-gray-800"
          >
            Agregar Docente
          </h3>
          <button
            id="closeTeacherModal"
            class="text-gray-500 hover:text-gray-700"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="teacherForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Nombre Completo</label
            >
            <input
              type="text"
              id="modalTeacherName"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Email</label
            >
            <input
              type="email"
              id="modalTeacherEmail"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Especialidad</label
            >
            <input
              type="text"
              id="modalTeacherSpecialty"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Tel√©fono</label
            >
            <input
              type="tel"
              id="modalTeacherPhone"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Estado</label
            >
            <select
              id="modalTeacherStatus"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg"
              required
            >
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
              <option value="licencia">En Licencia</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Notas</label
            >
            <textarea
              id="modalTeacherNotes"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg h-20"
              placeholder="Notas adicionales (opcional)"
            ></textarea>
          </div>

          <div class="flex space-x-3 pt-4">
            <button
              type="submit"
              class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-200"
            >
              Guardar
            </button>
            <button
              type="button"
              id="cancelTeacherModal"
              class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition duration-200"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
    <script>
      // ===========================================================================
      // EDUCONTROL PRO - CLIENT-SIDE JAVASCRIPT LOGIC
      // Versi√≥n: 0.3
      // Autor: Programadora Web Senior
      // ===========================================================================

      // ---------------------------------------------------------------------------
      // 1. GESTI√ìN DEL ESTADO DE LA APLICACI√ìN
      // ---------------------------------------------------------------------------
      // Objeto 'app' para centralizar el estado y la l√≥gica de la aplicaci√≥n.
      const app = {
        // Estado inicial de la aplicaci√≥n
        state: {
          isLoggedIn: false, // ¬øEl usuario est√° autenticado?
          currentUser: null, // Datos del usuario actual (nombre, rol, etc.)
          selectedCareer: null, // Carrera seleccionada ('software' o 'mecatronica')
          isLoading: false, // ¬øHay alguna operaci√≥n en curso?
          currentView: "login", // Vista actual ('login', 'dashboard', 'users', etc.)
        },

        // Almac√©n de selectores del DOM para f√°cil acceso y mantenimiento.
        selectors: {
          // Pantalla de Login
          loginSection: document.getElementById("login-section"),
          loginForm: document.getElementById("login-form"),
          careerSelect: document.getElementById("career-select"),
          emailInput: document.getElementById("email-input"),
          passwordInput: document.getElementById("password-input"),
          loginSpinner: document.getElementById("login-spinner"),
          loginButtonText: document.getElementById("login-button-text"),

          // Dashboard Principal
          appSection: document.getElementById("app-section"),
          sidebar: document.getElementById("sidebar"),
          mainContent: document.getElementById("main-content"),
          userNameDisplay: document.getElementById("user-name-display"),
          userRoleDisplay: document.getElementById("user-role-display"),

          // Notificaciones
          notificationContainer: document.getElementById(
            "notification-container"
          ),
        },

        // ---------------------------------------------------------------------------
        // 2. FUNCI√ìN DE INICIALIZACI√ìN
        // ---------------------------------------------------------------------------
        // Se ejecuta cuando el DOM est√° completamente cargado.
        init() {
          console.log("EduControl Pro v0.3 inicializado.");
          this.addEventListeners();
          // Podr√≠amos a√±adir aqu√≠ una funci√≥n que verifique si ya existe una sesi√≥n activa.
        },

        // ---------------------------------------------------------------------------
        // 3. MANEJADORES DE EVENTOS
        // ---------------------------------------------------------------------------
        addEventListeners() {
          // Manejar el env√≠o del formulario de login
          this.selectors.loginForm.addEventListener("submit", (e) => {
            e.preventDefault(); // Evita que la p√°gina se recargue
            this.handleLogin();
          });

          // Aqu√≠ a√±adiremos m√°s event listeners para los botones del sidebar, modales, etc.
        },

        // ---------------------------------------------------------------------------
        // 4. L√ìGICA DE AUTENTICACI√ìN Y COMUNICACI√ìN
        // ---------------------------------------------------------------------------
        handleLogin() {
          const email = this.selectors.emailInput.value;
          const password = this.selectors.passwordInput.value;
          const career = this.selectors.careerSelect.value;

          if (!email || !password || !career) {
            this.showNotification(
              "Por favor, completa todos los campos.",
              "error"
            );
            return;
          }

          // Actualizar la UI para mostrar que estamos procesando el login
          this.setLoading(true);
          this.state.selectedCareer = career; // Guardamos la carrera seleccionada

          // Llamada al backend de Google Apps Script
          google.script.run
            .withSuccessHandler(this.onLoginSuccess.bind(this))
            .withFailureHandler(this.onLoginFailure.bind(this))
            .userLogin(email, password, career); // Esta funci√≥n 'userLogin' la crearemos en C√≥digo.gs
        },

        onLoginSuccess(user) {
          this.setLoading(false);

          if (user && user.isLoggedIn) {
            this.state.isLoggedIn = true;
            this.state.currentUser = user;
            this.showNotification(`Bienvenido, ${user.name}.`, "success");

            // Actualizar la UI y mostrar el dashboard
            this.selectors.loginSection.classList.add("hidden");
            this.selectors.appSection.classList.remove("hidden");
            this.selectors.userNameDisplay.textContent = user.name;
            this.selectors.userRoleDisplay.textContent = user.role;

            // Cargar datos iniciales del dashboard (lo implementaremos a continuaci√≥n)
            this.loadDashboardData();
          } else {
            // El backend no devolvi√≥ un error, pero el login fall√≥ (credenciales incorrectas)
            this.onLoginFailure({
              message: "El correo electr√≥nico o la contrase√±a son incorrectos.",
            });
          }
        },

        onLoginFailure(error) {
          this.setLoading(false);
          this.showNotification(
            error.message || "Ocurri√≥ un error inesperado.",
            "error"
          );
        },

        // ---------------------------------------------------------------------------
        // 5. FUNCIONES DE UTILIDAD DE LA UI
        // ---------------------------------------------------------------------------

        setLoading(isLoading) {
          this.state.isLoading = isLoading;
          if (isLoading) {
            this.selectors.loginSpinner.classList.remove("hidden");
            this.selectors.loginButtonText.textContent = "Verificando...";
            this.selectors.loginForm.querySelector("button").disabled = true;
          } else {
            this.selectors.loginSpinner.classList.add("hidden");
            this.selectors.loginButtonText.textContent = "Ingresar";
            this.selectors.loginForm.querySelector("button").disabled = false;
          }
        },

        showNotification(message, type = "info") {
          const colors = {
            info: "bg-blue-500",
            success: "bg-green-500",
            error: "bg-red-500",
          };
          const icon = {
            info: "fa-info-circle",
            success: "fa-check-circle",
            error: "fa-exclamation-triangle",
          };

          const notification = document.createElement("div");
          notification.className = `notification-enter flex items-center text-white text-sm font-bold px-4 py-3 rounded-md shadow-lg mb-2 ${colors[type]}`;
          notification.innerHTML = `<i class="fas ${icon[type]} mr-2"></i> <p>${message}</p>`;

          this.selectors.notificationContainer.appendChild(notification);

          setTimeout(() => {
            notification.remove();
          }, 5000); // La notificaci√≥n desaparece despu√©s de 5 segundos
        },

        loadDashboardData() {
          // Aqu√≠ llamaremos a las funciones del backend para obtener usuarios, actividades, etc.
          // Ejemplo: google.script.run.withSuccessHandler(this.displayUsers).getRecords('users', this.state.selectedCareer);
          console.log("Cargando datos del dashboard...");
        },
      };

      // Punto de entrada: Iniciar la aplicaci√≥n cuando el contenido de la p√°gina est√© listo.
      document.addEventListener("DOMContentLoaded", () => app.init());
    </script>
  </body>
</html>
